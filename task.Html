<!DOCTYPE html>
<html onmouseup = "handleMouseUp()">
	<head>
		<meta charset="utf-8">
	</head>

	<body>

		<script>
			"use strict"
			
			var size = 200;



			var state = {A:  {x: 100, y: 300}, offsetA: {x: 200, y: 300}, offsetB: {x: 300, y: 200}, B:  {x: 300, y: 100}};
			function setState(value){
				for (var key in value){
					state[key] = value[key];
				}
				render();
			}

			var regexp = /^[-]?[0-9]+$|^[-]?[0-9]+[.][0-9]+$/;	
			function handleInput(e){

				var value = e.target.value; 
				if(!regexp.exec(value)){
					return
				}


				if(e.target.id.match(/Ax/)){
					setState({offsetA: {x: +value * 200 + 100, y: state.offsetA.y}})
				}else if(e.target.id.match(/Ay/)){
					setState({offsetA: {x: state.offsetA.x, y: (+value - 1) * -200 + 100}})
				}else if(e.target.id.match(/Bx/)){
					setState({offsetB: {x: +value * 200 + 100, y: state.offsetB.y}})
				}else if(e.target.id.match(/By/)){
					setState({offsetB: {x: state.offsetB.x, y: (+value - 1) * -200 + 100}})
				}

			}

			var targetMove = null;
			var offsetMouseX, offsetMouseY;
			var targetId = null;

			function handleMouseDown(e){
				targetMove = e.target;
				offsetMouseX = e.clientX - targetMove.getAttribute('cx');
				offsetMouseY = e.clientY - targetMove.getAttribute('cy');
				targetId = targetMove.id;
				window.addEventListener('mousemove', movePoint);
			}

			function handleMouseUp(){
				if(targetMove){
					window.removeEventListener('mousemove', movePoint);
					targetMove = null;
					targetId = null;
				}
			}

			function movePoint(e) {
				var x = e.clientX - offsetMouseX;
				var y = e.clientY - offsetMouseY;
				setState({[targetId]: {x: x, y: y}})				
			}

		</script>

		<svg width="100%" height="500" xmlns="http://www.w3.org/2000/svg">
			
			<circle id = "A" r="3" fill="red"/>
			<polyline id = "polylineA" stroke = 'red'/>
			<circle id = "offsetA" onmousedown="handleMouseDown(event)" r="3" fill="red"/>

			<circle id = "B" r="3" fill="red"/>
			<polyline id = "polylineB" stroke = 'red'/>
			<circle id = "offsetB" onmousedown="handleMouseDown(event)" r="3" fill="red"/>

			<path id = "bezierCurve" d='' stroke="black" fill="transparent"/>
		</svg>

		<label>offset Ax<input id = 'valueOffsetAx' type="text" onchange = 'handleInput(event)' type="text"></label>
		<label>offset Ay<input id = 'valueOffsetAy' type="text" onchange = 'handleInput(event)' type="text"><br></label>
		<label>offset Bx<input id = 'valueOffsetBx' type="text" onchange = 'handleInput(event)' type="text"></label>
		<label>offset By<input id = 'valueOffsetBy' type="text" onchange = 'handleInput(event)' type="text"></label>



		<script type="text/javascript">
			

			function render(){
				valueOffsetAx.value = ((state.offsetA.x - 100) / 200).toFixed(2);
				valueOffsetAy.value = (1 -(state.offsetA.y - 100) / 200).toFixed(2);

				valueOffsetBx.value = ((state.offsetB.x - 100) / 200).toFixed(2);
				valueOffsetBy.value =  (1 -(state.offsetB.y - 100) / 200).toFixed(2);

				renderBezierCurve()
			}


			function renderBezierCurve(){

				A.setAttribute("cx", state.A.x);
				A.setAttribute("cy", state.A.y);

				polylineA.setAttribute("points", `${state.A.x},${state.A.y} ${state.offsetA.x},${state.offsetA.y}`);

				offsetA.setAttribute("cx", state.offsetA.x);
				offsetA.setAttribute("cy", state.offsetA.y);

				B.setAttribute("cx", state.B.x);
				B.setAttribute("cy", state.B.y);

				polylineB.setAttribute("points", `${state.B.x},${state.B.y} ${state.offsetB.x},${state.offsetB.y}`);


				offsetB.setAttribute("cx", state.offsetB.x);
				offsetB.setAttribute("cy", state.offsetB.y);

				var valuePath = `M${state.A.x} ${state.A.y} C ${state.offsetA.x} ${state.offsetA.y}, ${state.offsetB.x} ${state.offsetB.y}, ${state.B.x} ${state.B.y}`;
				bezierCurve.setAttribute("d", valuePath);
			}
			render();

		</script>
	</body>
</html>